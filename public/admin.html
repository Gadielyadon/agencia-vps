<!DOCTYPE html>
<html lang="es">
<head>
	<!--
	Página administrativa: listado de órdenes y creación de productos.
	Relación: Usa API de `backend/server.js` (/api/ordenes y /api/productos) y lógica en `public/js/admin.js`.
	-->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Admin - Agencia</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body class="bg-light">
	<nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
		<div class="container">
			<a class="navbar-brand fw-bold" href="/">
				<i class="bi bi-bag-check me-2 text-primary"></i>Panel de admin- Agencia
			</a>
			<div class="ms-auto">
				<button id="adminLoginBtn" class="btn btn-outline-primary me-2" data-bs-toggle="modal" data-bs-target="#adminLoginModal">
					<i class="bi bi-person-lock me-1"></i>Iniciar sesión
				</button>
				<button id="adminLogoutBtn" class="btn btn-outline-secondary d-none"><i class="bi bi-box-arrow-right me-1"></i>Salir</button>
				<a href="/" class="btn btn-outline-secondary ms-2">Ir a catalogo</a>
			</div>
		</div>
	</nav>
	<main class="container my-4">
		<ul class="nav nav-tabs" id="adminTabs" role="tablist">
			
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="productos-tab" data-bs-toggle="tab" data-bs-target="#productos" type="button" role="tab" aria-controls="productos" aria-selected="false">
					<i class="bi bi-box-seam me-1"></i>Productos
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="categorias-tab" data-bs-toggle="tab" data-bs-target="#categorias" type="button" role="tab" aria-controls="categorias" aria-selected="false">
					<i class="bi bi-tags me-1"></i>Categorías
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="crear-tab" data-bs-toggle="tab" data-bs-target="#crearProducto" type="button" role="tab" aria-controls="crearProducto" aria-selected="false">
					<i class="bi bi-plus-circle me-1"></i>Crear producto
				</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="usuarios-tab" data-bs-toggle="tab" data-bs-target="#usuarios" type="button" role="tab" aria-controls="usuarios" aria-selected="false">
					<i class="bi bi-people me-1"></i>Usuarios
				</button>
			</li>
		</ul>
		<div class="tab-content border border-top-0 bg-white p-3 rounded-bottom" id="adminTabsContent">
			<div class="tab-pane fade show active" id="ordenes" role="tabpanel" aria-labelledby="ordenes-tab" tabindex="0">
				<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
					<h2 class="h5 m-0"></h2>
					<div class="d-flex align-items-center gap-2 flex-wrap">
					</div>
				</div>
				<div class="table-responsive">
					<table class="table align-middle">
						<thead class="table-light">
							<tr>
								<th>ID</th>
								<th>Cliente</th>
								<th>Estado</th>
								<th>Realizada</th>
								<th>Total</th>
								<th class="text-end">Acciones</th>
							</tr>
						
					</table>
				</div>
			</div>
			<div class="tab-pane fade" id="productos" role="tabpanel" aria-labelledby="productos-tab" tabindex="0">
				<div class="d-flex justify-content-between align-items-center mb-2">
					<h2 class="h6 m-0">Listado y edición de productos</h2>
					<div class="d-flex align-items-center gap-2">
						<form id="bulkProductDiscountForm" class="d-flex align-items-center gap-2">
							<div class="input-group input-group-sm" style="width: 260px;">
								<span class="input-group-text">Desc. %</span>
								<input type="number" class="form-control" name="porcentaje" min="0" max="100" step="0.01" placeholder="0 - 100">
								<select class="form-select" name="activar" style="max-width:110px;">
									<option value="1" selected>Activar</option>
									<option value="0">Desactivar</option>
								</select>
							</div>
							<button class="btn btn-sm btn-outline-danger" type="submit" title="Aplicar a todos los productos">
								<i class="bi bi-lightning-charge me-1"></i>Descuento masivo
							</button>
						</form>
						<input id="searchProductsInput" type="search" class="form-control form-control-sm" placeholder="Buscar por nombre, SKU...">
					</div>
				</div>
				<div class="table-responsive">
					<table class="table align-middle">
						<thead class="table-light">
							<tr>
								<th>ID</th>
								<th>SKU</th>
								<th>Nombre</th>
								<th class="text-end">Precio</th>
								<th class="text-end">Stock</th>
								<th>Activo</th>
								<th></th>
							</tr>
						</thead>
						<tbody id="productsTableBody">
							<tr><td colspan="7" class="text-secondary">Cargando...</td></tr>
						</tbody>
					</table>
				</div>
			</div>
			<div class="tab-pane fade" id="crearProducto" role="tabpanel" aria-labelledby="crear-tab" tabindex="0">
				<h2 class="h5 mb-3">Nuevo producto</h2>
<form id="productForm" class="row g-3" enctype="multipart/form-data">
  <div class="col-md-4">
    <label class="form-label">SKU</label>
    <input type="text" class="form-control" name="sku" required>
  </div>
  <div class="col-md-8">
    <label class="form-label">Nombre</label>
    <input type="text" class="form-control" name="nombre" required>
  </div>
  <div class="col-12">
    <label class="form-label">Descripción</label>
    <textarea class="form-control" name="descripcion" rows="3"></textarea>
  </div>
  <div class="col-md-4">
    <label class="form-label">Categoría</label>
    <select class="form-select" name="categoria_id" id="createCategoriaSelect">
      <option value="">(Sin categoría)</option>
    </select>
  </div>
  <div class="col-md-4">
    <label class="form-label">Descuento (%)</label>
    <input type="number" class="form-control" name="descuento_pct" min="0" max="100" step="0.01" placeholder="Ej: 15">
  </div>
  <div class="col-md-4">
    <label class="form-label">Estado descuento</label>
    <select class="form-select" name="descuento_activo">
      <option value="0" selected>Desactivado</option>
      <option value="1">Activado</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Precio (COP)</label>
    <input type="number" class="form-control" name="precio" min="0" step="1" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">Existencias</label>
    <input type="number" class="form-control" name="existencias" min="0" step="1" value="0" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">Moneda</label>
    <select class="form-select" name="moneda">
      <option value="COP" selected>COP</option>
      <option value="USD">USD</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Activo</label>
    <select class="form-select" name="activo">
      <option value="1" selected>Sí</option>
      <option value="0">No</option>
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Imagen del producto</label>
    <input type="file" id="imagenProducto" class="form-control" accept="image/*">
  </div>
  <img id="previewImg" style="max-width:150px; display:none; border-radius:8px; margin-bottom:10px;">

  <div class="col-12">
    <button class="btn btn-primary" type="submit"><i class="bi bi-save me-1"></i>Crear producto</button>
  </div>
</form>
			</div>
			<div class="tab-pane fade" id="categorias" role="tabpanel" aria-labelledby="categorias-tab" tabindex="0">
				<div class="d-flex justify-content-between align-items-center mb-2">
					<h2 class="h6 m-0">Categorías</h2>
					<form id="bulkCategoryDiscountForm" class="d-flex align-items-center gap-2">
						<div class="input-group input-group-sm" style="width: 260px;">
							<span class="input-group-text">Desc. %</span>
							<input type="number" class="form-control" name="porcentaje" min="0" max="100" step="0.01" placeholder="0 - 100">
							<select class="form-select" name="activar" style="max-width:110px;">
								<option value="1" selected>Activar</option>
								<option value="0">Desactivar</option>
							</select>
						</div>
						<button class="btn btn-sm btn-outline-danger" type="submit" title="Aplicar a todas las categorías">
							<i class="bi bi-lightning-charge me-1"></i>Descuento masivo
						</button>
					</form>
				</div>
				<div class="row g-3">
					<div class="col-lg-7">
						<div class="table-responsive">
							<table class="table align-middle">
								<thead class="table-light">
									<tr>
										<th>ID</th>
										<th>Nombre</th>
										<th>Slug</th>
										<th>Activo</th>
										<th>Desc. (%)</th>
										<th></th>
									</tr>
								</thead>
								<tbody id="categoriesTableBody">
									<tr><td colspan="6" class="text-secondary">Cargando...</td></tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="col-lg-5">
						<h3 class="h6">Crear/Editar categoría</h3>
						<form id="categoryForm" class="row g-3">
							<input type="hidden" name="id">
							<div class="col-12">
								<label class="form-label">Nombre</label>
								<input type="text" class="form-control" name="nombre" required>
							</div>
							<div class="col-12">
								<label class="form-label">Slug</label>
								<input type="text" class="form-control" name="slug" required>
							</div>
							<div class="col-12">
								<label class="form-label">Descripción</label>
								<textarea class="form-control" name="descripcion" rows="2"></textarea>
							</div>
							<div class="col-4">
								<label class="form-label">Activo</label>
								<select class="form-select" name="activo">
									<option value="1" selected>Sí</option>
									<option value="0">No</option>
								</select>
							</div>
							<div class="col-4">
								<label class="form-label">Desc. (%)</label>
								<input type="number" class="form-control" name="descuento_pct" min="0" max="100" step="0.01">
							</div>
							<div class="col-4">
								<label class="form-label">Estado desc.</label>
								<select class="form-select" name="descuento_activo">
									<option value="0" selected>Desactivado</option>
									<option value="1">Activado</option>
								</select>
							</div>
							<div class="col-12">
								<button class="btn btn-primary" type="submit"><i class="bi bi-save me-1"></i>Guardar categoría</button>
								<button id="resetCategoryFormBtn" class="btn btn-outline-secondary ms-2" type="button">Nueva</button>
							</div>
						</form>
					</div>
				</div>
			</div>
			<div class="tab-pane fade" id="usuarios" role="tabpanel" aria-labelledby="usuarios-tab" tabindex="0">
				<div class="row g-3">
					<div class="col-lg-6">
						<h2 class="h6">Crear nuevo usuario</h2>
						<form id="createUserForm" class="row g-3">
							<div class="col-md-6">
								<label class="form-label">Nombre</label>
								<input type="text" class="form-control" name="nombre" required>
							</div>
							<div class="col-md-6">
								<label class="form-label">Apellido</label>
								<input type="text" class="form-control" name="apellido" required>
							</div>
							<div class="col-md-7">
								<label class="form-label">Correo</label>
								<input type="email" class="form-control" name="correo" required>
							</div>
							<div class="col-md-5">
								<label class="form-label">Contraseña</label>
								<input type="password" class="form-control" name="password" minlength="6" required>
							</div>
							<div class="col-md-4">
								<label class="form-label">Rol</label>
								<select class="form-select" name="rol">
									<option value="cliente" selected>Cliente</option>
									<option value="admin">Admin</option>
								</select>
							</div>
							<div class="col-12">
								<button class="btn btn-primary" type="submit"><i class="bi bi-person-plus me-1"></i>Crear usuario</button>
							</div>
						</form>
					</div>
					<div class="col-lg-6">
						<h2 class="h6">Últimos usuarios</h2>
						<div class="table-responsive">
							<table class="table table-sm">
								<thead class="table-light">
									<tr><th>ID</th><th>Nombre</th><th>Correo</th><th>Rol</th></tr>
								</thead>
								<tbody id="usersTableBody">
									<tr><td colspan="4" class="text-secondary">Cargando...</td></tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>

	<!-- Modal Login Admin -->
	<div class="modal fade" id="adminLoginModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Ingreso administrador</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="adminLoginForm" class="row g-3">
						<div class="col-12">
							<label class="form-label">Correo</label>
							<input type="email" class="form-control" name="correo" value="admin@modanova.local" required>
						</div>
						<div class="col-12">
							<label class="form-label">Contraseña</label>
							<input type="password" class="form-control" name="password" value="admin123" required>
						</div>
						<div class="col-12 d-grid">
							<button class="btn btn-primary" type="submit"><i class="bi bi-box-arrow-in-right me-1"></i>Entrar</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal Editar Producto -->
	<div class="modal fade" id="editProductModal" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-lg modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">Editar producto</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="editProductForm" class="row g-3" enctype="multipart/form-data">
  <input type="hidden" name="id">
  <div class="col-md-4">
    <label class="form-label">SKU</label>
    <input type="text" class="form-control" name="sku" required>
  </div>
  <div class="col-md-8">
    <label class="form-label">Nombre</label>
    <input type="text" class="form-control" name="nombre" required>
  </div>
  <div class="col-12">
    <label class="form-label">Descripción</label>
    <textarea class="form-control" name="descripcion" rows="3"></textarea>
  </div>
  <div class="col-md-4">
    <label class="form-label">Categoría</label>
    <select class="form-select" name="categoria_id" id="editCategoriaSelect">
      <option value="">(Sin categoría)</option>
    </select>
  </div>
  <div class="col-md-4">
    <label class="form-label">Descuento (%)</label>
    <input type="number" class="form-control" name="descuento_pct" min="0" max="100" step="0.01">
  </div>
  <div class="col-md-4">
    <label class="form-label">Estado descuento</label>
    <select class="form-select" name="descuento_activo">
      <option value="0">Desactivado</option>
      <option value="1">Activado</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Precio (COP)</label>
    <input type="number" class="form-control" name="precio" min="0" step="1" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">Existencias</label>
    <input type="number" class="form-control" name="existencias" min="0" step="1" required>
  </div>
  <div class="col-md-3">
    <label class="form-label">Moneda</label>
    <select class="form-select" name="moneda">
      <option value="COP">COP</option>
      <option value="USD">USD</option>
    </select>
  </div>
  <div class="col-md-3">
    <label class="form-label">Activo</label>
    <select class="form-select" name="activo">
      <option value="1">Sí</option>
      <option value="0">No</option>
    </select>
  </div>
  <div class="mb-3">
    <label class="form-label">Imagen del producto</label>
    <input type="file" id="productoImagen" class="form-control" accept="image/*">
    <small class="text-muted">JPG, PNG o WEBP – máx 5MB</small>
  </div>
  <img id="editPreviewImg" style="max-width:150px; display:none; border-radius:8px; margin-bottom:10px;">
</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
					<button id="saveEditBtn" type="button" class="btn btn-primary"><i class="bi bi-save me-1"></i>Guardar cambios</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Toast -->
	<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
		<div id="adminToast" class="toast align-items-center text-bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
			<div class="d-flex">
				<div class="toast-body"></div>
				<button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<script src="/js/admin.js"></script>
</body>
</html>


